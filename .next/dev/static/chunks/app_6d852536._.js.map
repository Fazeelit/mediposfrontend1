{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/Backup/mediposfrontend1/app/authservice/api.jsx"],"sourcesContent":["// app/authservice/page.jsx\n\"use client\";\n\nimport axios from \"axios\";\nimport { toast } from \"react-hot-toast\";\n\nconst BASE_URL =\n  process.env.NEXT_PUBLIC_API_BASE_URL ||\n  \"https://mediposbackend.onrender.com/api\";\n\n/**\n * Generic API request function\n */\nexport async function apiRequest(\n  endpoint,\n  {\n    method = \"GET\",\n    data = null,\n    headers = {},\n    includeAuth = false,\n    formData = false,\n    successMessage = null,\n    timeout = 30 * 60 * 1000, // 30 minutes\n    params = null,\n    onUploadProgress = null,\n  } = {}\n) {\n  try {\n    let finalHeaders = { ...headers };\n\n    // ---------------------------------------------------------\n    // Handle Content-Type logic\n    // ---------------------------------------------------------\n    if (formData) {\n      // VERY IMPORTANT: Do NOT set Content-Type here\n      // Browser will generate correct boundary\n      delete finalHeaders[\"Content-Type\"];\n    } else if (data && typeof data === \"object\") {\n      finalHeaders[\"Content-Type\"] = \"application/json\";\n      data = JSON.stringify(data);\n    }\n\n    // ---------------------------------------------------------\n    // Authorization Header\n    // ---------------------------------------------------------\n    if (includeAuth && typeof window !== \"undefined\") {\n      const token = localStorage.getItem(\"authToken\");\n      if (token) finalHeaders[\"Authorization\"] = `Bearer ${token}`;\n    }\n\n    // ---------------------------------------------------------\n    // Create Request URL\n    // ---------------------------------------------------------\n    const url = `${BASE_URL}${endpoint.startsWith(\"/\") ? endpoint : \"/\" + endpoint}`;\n\n    console.log(\"API Request:\", {\n      url,\n      method,\n      sendingFormData: formData,\n      headers: finalHeaders,\n      params,\n      data,\n    });\n\n    // ---------------------------------------------------------\n    // Axios Config\n    // ---------------------------------------------------------\n    const config = {\n      url,\n      method: method.toUpperCase(),\n      headers: finalHeaders,\n      timeout,\n      maxBodyLength: Infinity,\n      maxContentLength: Infinity,\n    };\n\n    if (params) config.params = params;\n\n    if (typeof onUploadProgress === \"function\") {\n      config.onUploadProgress = onUploadProgress;\n    }\n\n    // Attach body only for non-GET/HEAD\n    if (![\"GET\", \"HEAD\"].includes(config.method)) {\n      config.data = data;\n    }\n\n    // ---------------------------------------------------------\n    // Make Request\n    // ---------------------------------------------------------\n    const response = await axios(config);\n\n    // ---------------------------------------------------------\n    // Success Toast\n    // ---------------------------------------------------------\n    const msg = successMessage || response.data?.message;\n    if (msg && typeof window !== \"undefined\") {\n      toast.success(msg);\n    }\n\n    return response.data;\n  } catch (error) {\n    console.error(\"API Request Error:\", error);\n\n    const errorMessage =\n      error.response?.data?.message ||\n      error.response?.data?.error ||\n      (error.code === \"ECONNABORTED\"\n        ? \"Request timed out. Please try again.\"\n        : null) ||\n      (error.message?.includes(\"Network Error\")\n        ? \"Network error â€” check your internet connection.\"\n        : null) ||\n      error.message ||\n      \"Something went wrong\";\n\n    if (typeof window !== \"undefined\") toast.error(errorMessage);\n\n    throw new Error(errorMessage);\n  }\n}\n"],"names":[],"mappings":"AAAA,2BAA2B;;;;;AAOzB;AAJF;AACA;AAHA;;;AAKA,MAAM,WACJ,2KAAO,CAAC,GAAG,CAAC,wBAAwB,IACpC;AAKK,eAAe,WACpB,QAAQ,EACR,EACE,SAAS,KAAK,EACd,OAAO,IAAI,EACX,UAAU,CAAC,CAAC,EACZ,cAAc,KAAK,EACnB,WAAW,KAAK,EAChB,iBAAiB,IAAI,EACrB,UAAU,KAAK,KAAK,IAAI,EACxB,SAAS,IAAI,EACb,mBAAmB,IAAI,EACxB,GAAG,CAAC,CAAC;IAEN,IAAI;QACF,IAAI,eAAe;YAAE,GAAG,OAAO;QAAC;QAEhC,4DAA4D;QAC5D,4BAA4B;QAC5B,4DAA4D;QAC5D,IAAI,UAAU;YACZ,+CAA+C;YAC/C,yCAAyC;YACzC,OAAO,YAAY,CAAC,eAAe;QACrC,OAAO,IAAI,QAAQ,OAAO,SAAS,UAAU;YAC3C,YAAY,CAAC,eAAe,GAAG;YAC/B,OAAO,KAAK,SAAS,CAAC;QACxB;QAEA,4DAA4D;QAC5D,uBAAuB;QACvB,4DAA4D;QAC5D,IAAI,eAAe,+CAAkB,aAAa;YAChD,MAAM,QAAQ,aAAa,OAAO,CAAC;YACnC,IAAI,OAAO,YAAY,CAAC,gBAAgB,GAAG,CAAC,OAAO,EAAE,OAAO;QAC9D;QAEA,4DAA4D;QAC5D,qBAAqB;QACrB,4DAA4D;QAC5D,MAAM,MAAM,GAAG,WAAW,SAAS,UAAU,CAAC,OAAO,WAAW,MAAM,UAAU;QAEhF,QAAQ,GAAG,CAAC,gBAAgB;YAC1B;YACA;YACA,iBAAiB;YACjB,SAAS;YACT;YACA;QACF;QAEA,4DAA4D;QAC5D,eAAe;QACf,4DAA4D;QAC5D,MAAM,SAAS;YACb;YACA,QAAQ,OAAO,WAAW;YAC1B,SAAS;YACT;YACA,eAAe;YACf,kBAAkB;QACpB;QAEA,IAAI,QAAQ,OAAO,MAAM,GAAG;QAE5B,IAAI,OAAO,qBAAqB,YAAY;YAC1C,OAAO,gBAAgB,GAAG;QAC5B;QAEA,oCAAoC;QACpC,IAAI,CAAC;YAAC;YAAO;SAAO,CAAC,QAAQ,CAAC,OAAO,MAAM,GAAG;YAC5C,OAAO,IAAI,GAAG;QAChB;QAEA,4DAA4D;QAC5D,eAAe;QACf,4DAA4D;QAC5D,MAAM,WAAW,MAAM,IAAA,mJAAK,EAAC;QAE7B,4DAA4D;QAC5D,gBAAgB;QAChB,4DAA4D;QAC5D,MAAM,MAAM,kBAAkB,SAAS,IAAI,EAAE;QAC7C,IAAI,OAAO,+CAAkB,aAAa;YACxC,mKAAK,CAAC,OAAO,CAAC;QAChB;QAEA,OAAO,SAAS,IAAI;IACtB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sBAAsB;QAEpC,MAAM,eACJ,MAAM,QAAQ,EAAE,MAAM,WACtB,MAAM,QAAQ,EAAE,MAAM,SACtB,CAAC,MAAM,IAAI,KAAK,iBACZ,yCACA,IAAI,KACR,CAAC,MAAM,OAAO,EAAE,SAAS,mBACrB,oDACA,IAAI,KACR,MAAM,OAAO,IACb;QAEF,wCAAmC,mKAAK,CAAC,KAAK,CAAC;QAE/C,MAAM,IAAI,MAAM;IAClB;AACF"}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///E:/Backup/mediposfrontend1/app/components/POS/ProductBill.jsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\nimport { FaArrowLeft } from \"react-icons/fa\";\nimport { useRouter } from \"next/navigation\";\nimport { apiRequest } from \"@/app/authservice/api\";\n\nexport default function PrintBillPage() {\n  const router = useRouter();\n\n  const [items, setItems] = useState([]);\n  const [discount, setDiscount] = useState(0);\n  const [mounted, setMounted] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  // Load cart from localStorage\n  useEffect(() => {\n    setMounted(true);\n    const stored = localStorage.getItem(\"printCart\");\n    if (!stored) return;\n\n    const parsed = JSON.parse(stored);\n    setItems(Array.isArray(parsed) ? parsed : parsed.items || []);\n    setDiscount(Number(parsed?.discount || 0));\n  }, []);\n\n  if (!mounted) return null;\n  if (items.length === 0)\n    return <div className=\"p-4 text-center\">No items to print.</div>;\n\n  const subtotal = items.reduce((sum, item) => sum + item.price * item.qty, 0);\n  const total = Math.max(subtotal - discount, 0);\n\n  const handleBack = () => router.back();\n\n  // ========================\n  // SIMPLE STOCK UPDATE LOGIC\n  // ========================\n  const updateStockAfterSale = async () => {\n    try {\n      for (const soldItem of items) {\n        // 1. Fetch all products with the same name\n        const res = await apiRequest(`/products?name=${encodeURIComponent(soldItem.name)}`, { method: \"GET\" });\n        const productsWithSameName = res?.data || [];\n\n        let remainingQty = soldItem.qty;\n\n        // 2. Deduct stock from each product until sold qty is fulfilled\n        for (const product of productsWithSameName) {\n          if (remainingQty <= 0) break;\n\n          const currentStock = Number(product.stock || 0);\n          const deduction = Math.min(currentStock, remainingQty);\n          const newStock = currentStock - deduction;\n\n          // 3. Update stock\n          await apiRequest(`/products/${product._id}/updateStock`, {\n            method: \"PATCH\",\n            data: { stock: newStock },\n          });\n\n          remainingQty -= deduction;\n        }\n      }\n    } catch (err) {\n      console.error(\"Failed to update stock:\", err);\n    }\n  };\n\n  const handlePrintAndCreateSale = async () => {\n    try {\n      setLoading(true);\n\n      const saleData = {\n        products: items.map((item) => ({\n          productId: item._id || item.id,\n          name: item.name,\n          quantity: item.qty,\n          cost: item.cost,\n          price: item.price,\n        })),\n        subtotal,\n        discount,\n        totalAmount: total,\n        customerName: \"Walk-in\",\n        paymentStatus: \"Paid\",\n      };\n\n      // Create sale\n      const res = await apiRequest(\"/sales/createSale\", {\n        method: \"POST\",\n        data: saleData,\n      });\n\n      if (res?.success) {\n        await updateStockAfterSale(); // update stock\n        localStorage.removeItem(\"printCart\");\n        window.print();\n        router.push(\"/pos\");\n      } else {\n        alert(res?.message || \"Failed to create sale\");\n      }\n    } catch (err) {\n      console.error(err);\n      alert(\"Failed to create sale\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"p-6\">\n      <button onClick={handleBack} className=\"mb-4 bg-teal-600 text-white px-4 py-2 rounded flex items-center gap-2\">\n        <FaArrowLeft /> Back to Cart\n      </button>\n\n      <div className=\"invoice-container bg-white shadow p-4 mx-auto\">\n        <div className=\"text-center mb-2\">\n          <h2 className=\"text-lg font-bold\">Store Name</h2>\n          <p className=\"text-xs\">{new Date().toLocaleString()}</p>\n          <hr className=\"my-2 border-t border-gray-400\" />\n        </div>\n\n        <table className=\"w-full text-xs border-collapse\">\n          <thead>\n            <tr>\n              <th>#</th>\n              <th>Item</th>\n              <th className=\"text-right\">Qty</th>\n              <th className=\"text-right\">Price</th>\n              <th className=\"text-right\">Total</th>\n            </tr>\n          </thead>\n          <tbody>\n            {items.map((item, idx) => (\n              <tr key={item._id || item.id || idx}>\n                <td>{idx + 1}</td>\n                <td>{item.name}</td>\n                <td className=\"text-right\">{item.qty}</td>\n                <td className=\"text-right\">Rs.{item.price.toFixed(2)}</td>\n                <td className=\"text-right font-bold\">Rs.{(item.price * item.qty).toFixed(2)}</td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n\n        <hr className=\"my-2 border-t border-gray-400\" />\n        <div className=\"text-xs space-y-1\">\n          <div className=\"flex justify-between\">\n            <span>Subtotal</span>\n            <span>Rs.{subtotal.toFixed(2)}</span>\n          </div>\n          {discount > 0 && (\n            <div className=\"flex justify-between text-red-600 font-medium\">\n              <span>Discount</span>\n              <span>Rs.{discount.toFixed(2)}</span>\n            </div>\n          )}\n          <div className=\"flex justify-between font-bold border-t pt-1\">\n            <span>Total</span>\n            <span>Rs.{total.toFixed(2)}</span>\n          </div>\n        </div>\n      </div>\n\n      <button\n        onClick={handlePrintAndCreateSale}\n        disabled={loading}\n        className=\"mt-4 w-full bg-teal-600 text-white py-2 rounded\"\n      >\n        {loading ? \"Processing...\" : \"Print\"}\n      </button>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 519, "column": 0}, "map": {"version":3,"sources":["file:///E:/Backup/mediposfrontend1/app/Print/page.jsx"],"sourcesContent":["\"use client\";\n\nimport ProductBill from \"../components/POS/ProductBill\";\n\n\n\nexport default function Expenses() {\n  return (\n \n   <ProductBill/>\n   \n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAMe,SAAS;IACtB,qBAEC,6LAAC,sJAAW;;;;;AAGf;KANwB"}}]
}